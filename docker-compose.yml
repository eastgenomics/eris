version: "3.9"
   
services:
  db:
    container_name: eris-db
    image: postgres:12.15-bullseye
    ports:
      - "5431:5432"
    restart: always
    volumes:
      - eris_db:/var/lib/postgresql/data/
    environment:
      - POSTGRES_DB=eris # change based on DB
      - POSTGRES_USER=postgres # change based on USER
      - POSTGRES_PASSWORD=root  # change based on PASSWORD
  web:
    container_name: eris-web
    image: eris-web:1.0
    build: .
    command: bash -c "python manage.py collectstatic --noinput && gunicorn panel_requests.wsgi:application --bind :8005"
    env_file:
      - /Users/jason/Github/eris/.env
    volumes:
      - eris_static:/app/staticfiles
    expose:
      - 8005
    depends_on:
      - db
    restart: always
  nginx:
    container_name: eris-nginx
    image: eris-nginx:1.0
    build: nginx
    volumes:
      - eris_static:/staticfiles
    environment:
      - VIRTUAL_HOST=localhost # change based on HOST
      - VIRTUAL_PATH=/eris # change based on PATH
    expose:
      - 8006 # make sure nginx/nginx.conf PORT is changed too
    depends_on:
      - web

volumes:
  eris_db:
  eris_static:

networks:
  default:
    name: nginx-default # change based on NETWORK
    external: true
